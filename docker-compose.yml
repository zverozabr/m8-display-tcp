# M8 Display Server - Docker Compose
# Run: docker compose up -d

services:
  m8-display:
    build: .
    container_name: m8-display
    restart: unless-stopped
    ports:
      # HTTP/WebSocket server
      - "8080:8080"
      # TCP proxy for remote m8c clients
      - "3333:3333"
    environment:
      - M8_HTTP_PORT=8080
      - M8_TCP_PORT=3333
      # Auto-detect M8 serial port
      - M8_SERIAL_PORT=
      - M8_LOG_LEVEL=info
    # USB device passthrough - M8 Teensy
    # Note: Run `lsusb` to find your M8 device
    # M8 VID:PID is 16c0:048a or 16c0:048b
    devices:
      - /dev/ttyACM0:/dev/ttyACM0
      - /dev/snd:/dev/snd
    volumes:
      - /run/udev:/run/udev:ro
    group_add:
      - audio
      - dialout
    # Required for USB access (use ONE of these options):
    # Option 1: privileged (easier but less secure)
    privileged: true
    # Option 2: specific permissions (more secure, uncomment below and remove privileged)
    # device_cgroup_rules:
    #   - 'c 166:* rmw'  # ttyACM devices
    #   - 'c 116:* rmw'  # ALSA devices
